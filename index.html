<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventory</title>

<style>
:root {
  --bg:#f1f5f9;
  --panel:#ffffff;
  --border:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
  --ps:#2563eb;
  --xbox:#16a34a;
  --nintendo:#dc2626;
  --ipad:#111827;
}

  .saved-row {
  animation: savedFlash 0.8s ease;
}

@keyframes savedFlash {
  0%   { background: #dcfce7; }
  100% { background: transparent; }
}

.save-badge {
  display: inline-block;
  margin-left: 10px;
  font-size: 12px;
  color: #16a34a;
  font-weight: 600;
  opacity: 0;
  animation: badgeFade 1.2s ease forwards;
}

@keyframes badgeFade {
  0%   { opacity: 0; transform: translateY(2px); }
  30%  { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; }
}


*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui;
  background:
    radial-gradient(1200px 400px at top center, #e0e7ff 0%, transparent 60%),
    var(--bg);
  background-repeat:no-repeat;
  background-attachment:fixed;
  color:var(--text);
  padding:36px 20px;
}

.wrapper{
  max-width:1150px;
  margin:auto;
}

.tiles{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:18px;
  margin-bottom:28px;
}

.tile{
  background:var(--panel);
  border-radius:18px;
  padding:20px;
  display:flex;
  gap:16px;
  cursor:pointer;
  box-shadow:0 12px 28px rgba(0,0,0,.08);
  border-left:6px solid transparent;
  transition:transform .2s ease, box-shadow .2s ease;
}
.tile:hover{
  transform:translateY(-2px);
  box-shadow:0 18px 36px rgba(0,0,0,.12);
}
.tile.active{
  outline:2px solid #c7d2fe;
}

.tile.ps{border-left-color:var(--ps)}
.tile.xbox{border-left-color:var(--xbox)}
.tile.nintendo{border-left-color:var(--nintendo)}
.tile.ipad{border-left-color:var(--ipad)}

.tile-logo{
  width:52px;
  height:52px;
  border-radius:14px;
  background:#f8fafc;
  display:flex;
  align-items:center;
  justify-content:center;
}
.tile-logo img{
  max-width:36px;
  max-height:36px;
}

.panel{
  background:var(--panel);
  border-radius:22px;
  overflow:hidden;
  box-shadow:0 30px 60px rgba(0,0,0,.12);
}

.panel-brand{
  text-align:center;
  padding:28px 20px 12px;
  border-bottom:1px solid var(--border);
}

.panel-brand img{
  height:80px; /* <-- logo size */
  margin-bottom:12px;
}

.panel-title{
  font-size:18px;
  font-weight:600;
  letter-spacing:-0.01em;
}

.panel-subtitle{
  font-size:13px;
  color:var(--muted);
  margin-top:4px;
}

.header{
  padding:26px 30px;
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid var(--border);
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:16px 30px;
  border-bottom:1px solid var(--border);
}

th{
  background:#f8fafc;
  font-size:12px;
  color:var(--muted);
  position:sticky;
  top:0;
  z-index:2;
}

.stock-ok{color:#16a34a;font-weight:600}
.stock-low{color:#f59e0b;font-weight:600}
.stock-critical{
  color:#dc2626;
  font-weight:700;
  text-shadow:0 0 8px rgba(220,38,38,.35);
}

.action-btn{
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:6px 14px;
  cursor:pointer;
}

.secondary{
  background:#e5e7eb;
  color:#0f172a;
}

.stock-input{
  width:90px;
  padding:6px;
  border-radius:8px;
  border:1px solid var(--border);
}

tbody tr:hover{
  background:#f8fafc;
}

tbody tr:nth-child(even){
  background:#fbfdff;
}
</style>
</head>

<body>
<div class="wrapper">

  <div id="brandTiles" class="tiles"></div>

  <div class="panel">
    <div class="panel-brand">
      <img src="/logo.webp" alt="Logo">
      <div class="panel-title">Console Parts Inventory</div>
      <div class="panel-subtitle">Live stock management</div>
    </div>

    <div class="header">
      <h2 id="tableTitle">Select a brand</h2>
      <button id="unlockBtn" onclick="unlockEditing()">ðŸ”’ Unlock Editing</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Part</th>
          <th>Brand</th>
          <th>Stock</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://thvbweemnzdvwyaxvwbz.supabase.co";
const SUPABASE_KEY = "sb_publishable_U6Nsj6HClebAVWOx7MLhng_3t2z6w1G";
const EDIT_PASSWORD = "BeckyStock";

const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let allData=[], activeBrand=null, editingUnlocked=false;

const brands=[
 {name:"PlayStation",key:"ps",logo:"https://w7.pngwing.com/pngs/576/731/png-transparent-playstation-4-playstation-3-playstation-blue-angle-electronics-thumbnail.png"},
 {name:"Xbox",key:"xbox",logo:"https://toppng.com/uploads/preview/xbox-logo-png-1518x1490-117357646030uslcz65ud.webp"},
 {name:"Nintendo",key:"nintendo",logo:"https://w7.pngwing.com/pngs/638/371/png-transparent-nintendo-logo-nintendo-cdr-text-rectangle.png"},
 {name:"iPad",key:"ipad",logo:"https://www.freepnglogos.com/uploads/apple-logo-png/apple-logo-icon-16.png"}
];

function stockClass(v){
  return v<10?"stock-critical":v<20?"stock-low":"stock-ok";
}

/* NEW: Brand stats for tile summary */
function getBrandStats(brandName){
  const items = allData.filter(p => p.brand === brandName);
  const total = items.length;
  const critical = items.filter(p => p.stock < 10).length;
  return { total, critical };
}

function renderTiles(){
  const c=document.getElementById("brandTiles");
  c.innerHTML="";

  brands.forEach(b=>{
    const stats = getBrandStats(b.name);

    const tile=document.createElement("div");
    tile.className=`tile ${b.key} ${activeBrand===b.name?"active":""}`;
    tile.onclick=()=>{
      activeBrand=b.name;
      renderTiles();
      renderTable();
    };

    tile.innerHTML=`
      <div class="tile-logo"><img src="${b.logo}"></div>
      <div>
        <strong>${b.name}</strong>
        <div style="font-size:12px; color:var(--muted); margin-top:6px;">
          ${stats.total} parts â€¢ ${stats.critical} critical
        </div>
      </div>
    `;
    c.appendChild(tile);
  });
}

function renderTable(){
  if(!activeBrand) return;
  document.getElementById("tableTitle").innerText=`${activeBrand} Parts`;
  const body=document.getElementById("tableBody");
  body.innerHTML="";

  allData.filter(p=>p.brand===activeBrand).forEach(p=>{
    body.innerHTML+=`
      <tr>
        <td>${p.name}</td>
        <td>${p.brand}</td>
        <td class="${stockClass(p.stock)}">${p.stock}</td>
        <td>${editingUnlocked?`<button class="action-btn" onclick="startEdit(this,${p.id},${p.stock})">Edit</button>`:""}</td>
      </tr>`;
  });
}

function unlockEditing(){
  if(prompt("Password")==EDIT_PASSWORD){
    editingUnlocked=true;

    const btn = document.getElementById("unlockBtn");
    btn.innerText = "Unlocked";
    btn.style.background = "#16a34a";
    btn.style.color = "#fff";
    btn.disabled = true;

    renderTable();
  }
}

function startEdit(btn,id,stock){
  btn.parentElement.previousElementSibling.innerHTML=
    `<input class="stock-input" type="number" value="${stock}">`;
  btn.parentElement.innerHTML=
    `<button class="action-btn" onclick="saveEdit(this,${id})">Save</button>
     <button class="action-btn secondary" onclick="renderTable()">Cancel</button>`;
}

async function saveEdit(btn,id){
  const row = btn.closest("tr");
  const input = row.querySelector("input");
  const val = parseInt(input.value);

  await client.from("products").update({stock:val}).eq("id",id);

  const item = allData.find(p => p.id === id);
  if(item) item.stock = val;

  renderTable();
  renderTiles();

  // Re-find the updated row
  const rows = [...document.querySelectorAll("#tableBody tr")];
  const updatedRow = rows.find(r => r.innerText.includes(item.name));

  if(updatedRow){
    updatedRow.classList.add("saved-row");

    const stockCell = updatedRow.children[2];
    stockCell.innerHTML += `<span class="save-badge">âœ” Saved</span>`;

    setTimeout(() => {
      updatedRow.classList.remove("saved-row");
    }, 800);
  }
}


async function loadStock(){
  const {data}=await client.from("products").select("*");
  allData=data||[];
  renderTable();
  renderTiles();
}

renderTiles();
loadStock();
</script>
</body>
</html>

