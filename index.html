<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Console Parts Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root {
  --bg: #f1f5f9;
  --panel: #ffffff;
  --border: #e5e7eb;
  --text: #0f172a;
  --muted: #64748b;

  --ps: #2563eb;
  --xbox: #16a34a;
  --nintendo: #dc2626;
  --ipad: #111827;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 36px 20px;
}

.wrapper {
  max-width: 1150px;
  margin: auto;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BRAND TILES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

.tiles {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 18px;
  margin-bottom: 28px;
}

.tile {
  background: var(--panel);
  border-radius: 18px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  box-shadow: 0 12px 28px rgba(15,23,42,0.08);
  transition: all .18s ease;
  border-left: 6px solid transparent;
}

.tile:hover {
  transform: translateY(-2px);
  box-shadow: 0 16px 34px rgba(15,23,42,0.12);
}

.tile.active {
  outline: 2px solid #cbd5f5;
}

.tile.ps { border-left-color: var(--ps); }
.tile.xbox { border-left-color: var(--xbox); }
.tile.nintendo { border-left-color: var(--nintendo); }
.tile.ipad { border-left-color: var(--ipad); }

.tile-logo {
  width: 52px;
  height: 52px;
  border-radius: 14px;
  background: #f8fafc;
  display: flex;
  align-items: center;
  justify-content: center;
}

.tile-logo img {
  max-width: 36px;
  max-height: 36px;
  object-fit: contain;
}

.tile h3 {
  margin: 0 0 6px;
  font-size: 16px;
  font-weight: 600;
}

.tile p {
  margin: 0;
  font-size: 13px;
  color: var(--muted);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TABLE PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

.panel {
  background: var(--panel);
  border-radius: 22px;
  overflow: hidden;
  box-shadow: 0 24px 48px rgba(15,23,42,0.12);
}

.header {
  padding: 26px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--border);
}

.header h2 {
  margin: 0;
  font-size: 20px;
}

.unlock-btn {
  background: #0f172a;
  color: white;
  border: none;
  border-radius: 999px;
  padding: 10px 18px;
  font-size: 13px;
  cursor: pointer;
}

.unlock-btn.unlocked {
  background: #16a34a;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: #f8fafc;
  text-align: left;
  font-size: 12px;
  color: var(--muted);
  padding: 14px 30px;
  border-bottom: 1px solid var(--border);
}

td {
  padding: 16px 30px;
  border-bottom: 1px solid var(--border);
  font-size: 14px;
}

.stock-ok { color: #16a34a; font-weight: 600; }
.stock-low { color: #f59e0b; font-weight: 600; }
.stock-critical { color: #dc2626; font-weight: 700; }

.action-btn {
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  font-size: 13px;
  cursor: pointer;
}

.secondary {
  background: #e5e7eb;
  color: #0f172a;
}

.stock-input {
  width: 90px;
  padding: 6px;
  border-radius: 8px;
  border: 1px solid var(--border);
  font-size: 14px;
}
</style>
</head>

<body>
<div class="wrapper">

  <div class="tiles" id="brandTiles"></div>

  <div class="panel">
    <div class="header">
      <h2 id="tableTitle">Select a brand</h2>
      <button id="unlockBtn" class="unlock-btn" onclick="unlockEditing()">ðŸ”’ Unlock Editing</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Part</th>
          <th>Brand</th>
          <th>Stock</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "PASTE_YOUR_PROJECT_URL";
const SUPABASE_KEY = "PASTE_YOUR_ANON_KEY";
const EDIT_PASSWORD = "CHANGE_ME";

const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let allData = [];
let activeBrand = null;
let editingUnlocked = false;

const brands = [
  { name: "PlayStation", key: "ps", logo: "https://w7.pngwing.com/pngs/576/731/png-transparent-playstation-4-playstation-3-playstation-blue-angle-electronics-thumbnail.png" },
  { name: "Xbox", key: "xbox", logo: "https://toppng.com/uploads/preview/xbox-logo-png-1518x1490-117357646030uslcz65ud.webp" },
  { name: "Nintendo", key: "nintendo", logo: "https://w7.pngwing.com/pngs/638/371/png-transparent-nintendo-logo-nintendo-cdr-text-rectangle.png" },
  { name: "iPad", key: "ipad", logo: "https://www.freepnglogos.com/uploads/apple-logo-png/apple-logo-icon-16.png" }
];

function stockClass(v) {
  if (v < 10) return "stock-critical";
  if (v < 20) return "stock-low";
  return "stock-ok";
}

async function loadStock() {
  const { data, error } = await client
    .from("products")
    .select("id, name, brand, stock")
    .order("name");

  if (error) {
    alert(error.message);
    return;
  }

  allData = data;
  renderTiles();
}

function renderTiles() {
  const container = document.getElementById("brandTiles");
  container.innerHTML = "";

  brands.forEach(b => {
    const count = allData.filter(p => p.brand === b.name).length;
    const low = allData.filter(p => p.brand === b.name && p.stock < 10).length;

    const tile = document.createElement("div");
    tile.className = `tile ${b.key} ${activeBrand === b.name ? "active" : ""}`;
    tile.onclick = () => {
      activeBrand = b.name;
      renderTiles();
      renderTable();
    };

    tile.innerHTML = `
      <div class="tile-logo">
        <img src="${b.logo}">
      </div>
      <div>
        <h3>${b.name}</h3>
        <p>${count} parts Â· ${low} critical</p>
      </div>
    `;

    container.appendChild(tile);
  });
}

function renderTable() {
  if (!activeBrand) return;

  document.getElementById("tableTitle").innerText = `${activeBrand} Parts`;
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  allData
    .filter(p => p.brand === activeBrand)
    .forEach(item => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.brand}</td>
        <td class="${stockClass(item.stock)}">${item.stock}</td>
        <td>
          ${editingUnlocked ? `<button class="action-btn" onclick="startEdit(this, ${item.id}, ${item.stock})">Edit</button>` : ""}
        </td>
      `;
      body.appendChild(row);
    });
}

function unlockEditing() {
  const pw = prompt("Enter edit password:");
  if (pw === EDIT_PASSWORD) {
    editingUnlocked = true;
    const btn = document.getElementById("unlockBtn");
    btn.textContent = "ðŸ”“ Editing Enabled";
    btn.classList.add("unlocked");
    renderTable();
  } else {
    alert("Incorrect password");
  }
}

function startEdit(btn, id, stock) {
  const td = btn.parentElement.previousElementSibling;
  const actions = btn.parentElement;

  td.innerHTML = `<input class="stock-input" type="number" value="${stock}">`;
  actions.innerHTML = `
    <button class="action-btn" onclick="saveEdit(this, ${id})">Save</button>
    <button class="action-btn secondary" onclick="renderTable()">Cancel</button>
  `;
}

/* âœ… FIXED SAVE FUNCTION */
async function saveEdit(btn, id) {
  const input = btn.parentElement.previousElementSibling.querySelector("input");
  const value = parseInt(input.value);

  if (isNaN(value)) {
    renderTable();
    return;
  }

  const { error } = await client
    .from("products")
    .update({ stock: value })
    .eq("id", id);

  if (error) {
    alert(error.message);
    renderTable();
    return;
  }

  // Update local cache
  const item = allData.find(p => p.id === id);
  if (item) item.stock = value;

  // Re-render immediately
  renderTable();
  renderTiles();
}

loadStock();
</script>
</body>
</html>
