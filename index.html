<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Inventory Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg-gradient: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  --card-bg: #ffffff;
  --accent: #4f46e5;
  --ok: #16a34a;
  --low: #f59e0b;
  --critical: #dc2626;
}

* { box-sizing:border-box; font-family: Inter, system-ui, sans-serif; }

body {
  margin:0;
  min-height:100vh;
  background: var(--bg-gradient);
  background-attachment: fixed;
  padding:40px;
  color:#111;
}

.header {
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-bottom:30px;
}

.tiles {
  display:grid;
  grid-template-columns: repeat(4,1fr);
  gap:20px;
}

.tile {
  background:rgba(255,255,255,.12);
  backdrop-filter: blur(12px);
  border-radius:16px;
  padding:20px;
  cursor:pointer;
  color:white;
  transition:.25s;
  border:1px solid rgba(255,255,255,.15);
}

.tile:hover { transform:translateY(-4px); }

.tile img { height:28px; margin-bottom:10px; }

.tile h3 { margin:5px 0; }

.stats { font-size:13px; opacity:.85; }

.live {
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:600;
  color:white;
}

.dot {
  width:12px;
  height:12px;
  border-radius:50%;
}

.live.on .dot {
  background:#22c55e;
  box-shadow:0 0 12px #22c55e;
  animation:pulse 1.5s infinite;
}

.live.off .dot {
  background:#ef4444;
  box-shadow:0 0 12px #ef4444;
}

@keyframes pulse {
  0%{box-shadow:0 0 0 rgba(34,197,94,.7);}
  70%{box-shadow:0 0 20px rgba(34,197,94,0);}
  100%{box-shadow:0 0 0 rgba(34,197,94,0);}
}

.main {
  margin-top:40px;
  background:white;
  border-radius:20px;
  padding:30px;
  box-shadow:0 30px 60px rgba(0,0,0,.25);
}

.center-logo {
  display:flex;
  justify-content:center;
  margin-bottom:20px;
}

.center-logo img {
  height:90px;
}

h2 {
  text-align:center;
  margin-bottom:20px;
}

table {
  width:100%;
  border-collapse:collapse;
}

th,td {
  padding:14px;
  border-bottom:1px solid #eee;
}

th { text-align:left; }

.stock-ok { color:var(--ok); font-weight:600; }
.stock-low { color:var(--low); font-weight:600; }
.stock-critical { color:var(--critical); font-weight:700; }

button {
  padding:8px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}

.edit { background:#e5e7eb; }
.save { background:#22c55e; color:white; }
.cancel { background:#ef4444; color:white; }

.unlock {
  margin-bottom:15px;
  background:#e5e7eb;
}

.unlock.active {
  background:#22c55e;
  color:white;
}
</style>
</head>

<body>

<div class="header">
  <div class="tiles">
    <div class="tile" onclick="loadBrand('PlayStation')">
      <img src="https://w7.pngwing.com/pngs/576/731/png-transparent-playstation-4-playstation-3-playstation-blue-angle-electronics-thumbnail.png">
      <h3>PlayStation</h3>
      <div class="stats" id="ps-stats"></div>
    </div>

    <div class="tile" onclick="loadBrand('Xbox')">
      <img src="https://toppng.com/uploads/preview/xbox-logo-png-1518x1490-117357646030uslcz65ud.webp">
      <h3>Xbox</h3>
      <div class="stats" id="xbox-stats"></div>
    </div>

    <div class="tile" onclick="loadBrand('Nintendo')">
      <img src="https://w7.pngwing.com/pngs/638/371/png-transparent-nintendo-logo-nintendo-cdr-text-rectangle.png">
      <h3>Nintendo</h3>
      <div class="stats" id="nin-stats"></div>
    </div>

    <div class="tile" onclick="loadBrand('iPad')">
      <img src="https://www.freepnglogos.com/uploads/apple-logo-png/apple-logo-icon-16.png">
      <h3>iPad</h3>
      <div class="stats" id="ipad-stats"></div>
    </div>
  </div>

  <div class="live" id="liveStatus">
    <div class="dot"></div>
    <span id="liveText">Checkingâ€¦</span>
  </div>
</div>

<div class="main">
  <button class="unlock" id="unlockBtn" onclick="toggleEdit()">Unlock Editing</button>

  <div class="center-logo">
    <img src="logo.webp">
  </div>

  <h2 id="tableTitle">Select a brand</h2>

  <table>
    <thead>
      <tr>
        <th>Product</th>
        <th>Stock</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
const SUPABASE_URL = "https://thvbweemnzdvwyaxvwbz.supabase.co";
const SUPABASE_KEY = "sb_publishable_U6Nsj6HClebAVWOx7MLhng_3t2z6w1G";
const EDIT_PASSWORD = "BeckyStock";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let editingUnlocked = false;
let currentBrand = null;

function toggleEdit(){
  if(!editingUnlocked){
    const input = prompt("Enter edit password:");
    if(input !== EDIT_PASSWORD){
      alert("Incorrect password");
      return;
    }
    editingUnlocked = true;
    unlockBtn.classList.add("active");
    unlockBtn.textContent = "Editing Unlocked";
  } else {
    editingUnlocked = false;
    unlockBtn.classList.remove("active");
    unlockBtn.textContent = "Unlock Editing";
  }
}

function thresholds(p){
  return {
    low: Number.isInteger(p.low_threshold) && p.low_threshold > 0 ? p.low_threshold : 20,
    critical: Number.isInteger(p.critical_threshold) && p.critical_threshold > 0 ? p.critical_threshold : 10
  };
}

function stockClass(p){
  const t = thresholds(p);
  if(p.stock <= t.critical) return "stock-critical";
  if(p.stock <= t.low) return "stock-low";
  return "stock-ok";
}

function stockStatus(p){
  const t = thresholds(p);
  if(p.stock <= t.critical) return "Critical";
  if(p.stock <= t.low) return "Low";
  return "OK";
}

async function loadBrand(brand){
  currentBrand = brand;
  tableTitle.textContent = brand + " Parts";
  const { data } = await supabase.from("products").select("*").eq("brand",brand);
  render(data || []);
}

function render(data){
  tableBody.innerHTML = "";
  data.forEach(p=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.product}</td>
      <td class="${stockClass(p)}">${p.stock}</td>
      <td>${stockStatus(p)}</td>
      <td>
        <button class="edit" onclick="editRow(this,${p.id},${p.stock})">Edit</button>
      </td>`;
    tableBody.appendChild(tr);
  });
}

function editRow(btn,id,value){
  if(!editingUnlocked) return;
  const td = btn.parentElement.previousElementSibling.previousElementSibling;
  td.innerHTML = `<input type="number" value="${value}" />`;
  btn.outerHTML = `
    <button class="save" onclick="saveRow(this,${id})">Save</button>
    <button class="cancel" onclick="loadBrand(currentBrand)">Cancel</button>`;
}

async function saveRow(btn,id){
  const input = btn.parentElement.previousElementSibling.querySelector("input");
  const value = Number(input.value);
  await supabase.from("products").update({ stock:value }).eq("id",id);
  loadBrand(currentBrand);
}

async function checkLive(){
  const { error } = await supabase.from("products").select("id").limit(1);
  liveStatus.className = "live " + (error ? "off" : "on");
  liveText.textContent = error ? "Offline" : "Live";
}

checkLive();
</script>

</body>
</html>
