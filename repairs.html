<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Repairs</title>

<style>
:root{
  --bg:#f1f5f9;
  --panel:#ffffff;
  --border:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
  --amber:#f59e0b;
  --green:#16a34a;
  --red:#dc2626;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui;
  background:
    radial-gradient(1200px 400px at top center,#e0e7ff 0%,transparent 60%),
    var(--bg);
  padding:36px 20px;
}

.wrapper{max-width:900px;margin:auto;}

.panel{
  background:var(--panel);
  border-radius:22px;
  box-shadow:0 30px 60px rgba(0,0,0,.12);
  padding:28px 24px;
}

.panel-header{text-align:center;margin-bottom:20px;}
.panel-header h1{margin:0;font-size:20px;}
.panel-header p{margin:4px 0 0;font-size:13px;color:var(--muted);}

.header-right{
  display:flex;
  justify-content:flex-end;
  margin-bottom:20px;
}

.action-btn{
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:6px 14px;
  cursor:pointer;
}
.secondary{background:#e5e7eb;color:#0f172a;}
.danger{background:var(--red);}

table{
  width:100%;
  border-collapse:collapse;
  text-align:center;
}

th,td{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
}

th{
  background:#f8fafc;
  font-size:12px;
  color:var(--muted);
}

tbody tr:hover{background:#f8fafc}

form{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:20px;
}

input,select{
  padding:6px;
  border-radius:8px;
  border:1px solid var(--border);
  min-width:120px;
}

.status-open{
  background:var(--amber);
  color:#fff;
  padding:2px 6px;
  border-radius:6px;
  font-weight:600;
}
.status-completed{
  background:var(--green);
  color:#fff;
  padding:2px 6px;
  border-radius:6px;
  font-weight:600;
}

.edit-input{
  width:100%;
  padding:4px 6px;
  border-radius:6px;
  border:1px solid var(--border);
}
</style>
</head>

<body>
<div class="wrapper">
<div class="panel">

  <div class="panel-header">
    <h1>Daily Repairs</h1>
    <p>Live shared repair tracking</p>
  </div>

  <div class="header-right">
    <button class="action-btn secondary" onclick="location.href='index.html'">â¬… Back</button>
  </div>

  <form id="repairForm">
    <input id="username" placeholder="Username" required>
    <input id="item" placeholder="Item" required>
    <input id="notes" placeholder="Status notes" required>
    <select id="status">
      <option value="open">Open</option>
      <option value="completed">Completed</option>
    </select>
    <button class="action-btn">Add</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Item</th>
        <th>Status Notes</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://thvbweemnzdvwyaxvwbz.supabase.co";
const SUPABASE_KEY = "sb_publishable_U6Nsj6HClebAVWOx7MLhng_3t2z6w1G";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const tbody = document.getElementById('rows');
const form = document.getElementById('repairForm');

async function load(){
  const { data, error } = await client
    .from('repairs')
    .select('*')
    .order('created_at',{ascending:false});

  if(error){alert(error.message);return;}
  render(data);
}

function render(data){
  tbody.innerHTML='';
  data.forEach(r=>{
    const cls = r.status==='completed'?'status-completed':'status-open';
    tbody.innerHTML += `
      <tr>
        <td>${r.username}</td>
        <td>${r.item}</td>
        <td>${r.notes}</td>
        <td><span class="${cls}">${r.status}</span></td>
        <td>
          <button class="action-btn" onclick="edit(${r.id})">Edit</button>
          <button class="action-btn danger" onclick="del(${r.id})">Delete</button>
        </td>
      </tr>`;
  });
}

async function edit(id){
  const { data } = await client.from('repairs').select('*').eq('id',id).single();
  const row = [...tbody.children].find(r=>r.innerHTML.includes(`edit(${id})`));

  row.innerHTML = `
    <td><input class="edit-input" value="${data.username}"></td>
    <td><input class="edit-input" value="${data.item}"></td>
    <td><input class="edit-input" value="${data.notes}"></td>
    <td>
      <select class="edit-input">
        <option value="open" ${data.status==='open'?'selected':''}>Open</option>
        <option value="completed" ${data.status==='completed'?'selected':''}>Completed</option>
      </select>
    </td>
    <td>
      <button class="action-btn" onclick="save(${id},this)">Save</button>
    </td>`;
}

async function save(id,btn){
  const row = btn.closest('tr');
  const inputs = row.querySelectorAll('input,select');

  await client.from('repairs').update({
    username:inputs[0].value,
    item:inputs[1].value,
    notes:inputs[2].value,
    status:inputs[3].value
  }).eq('id',id);

  load();
}

async function del(id){
  if(!confirm('Delete this entry?')) return;
  await client.from('repairs').delete().eq('id',id);
  load();
}

form.onsubmit = async e =>{
  e.preventDefault();
  await client.from('repairs').insert({
    username:username.value,
    item:item.value,
    notes:notes.value,
    status:status.value
  });
  form.reset();
  load();
};

load();
</script>
</body>
</html>
